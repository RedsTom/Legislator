<p-header>
  <h1>Rapports</h1>
</p-header>

@let reports = reports$ | async;
<div id="content">
  @if (!loading$()) {
    <div id="loaded">
      @for (reportGroup of (reports?.reports ?? [] | groupBy: groupByDate).entries(); track reportGroup[0]) {
        <h2 id="day">{{ reportGroup[0] }}</h2>
        <div id="seances">
          @for (report of reportGroup[1]; track report.pageLink) {
            <p-card
              [header]="report.title"
              [subheader]="report.orders[0]"
              [styleClass]="'card'"
              [style]="{ width: '100%' }"
              [dt]="{
                colorScheme: {
                  light: {
                    background: '{surface.50}',
                  },
                  dark: {
                    background: '{surface.800}',
                  }
                }
              }"
            >
              <p-timeline [value]="report.orders.slice(1)" align="left" styleClass="seance-timeline">
                <ng-template #content let-order>
                  @if (order.includes("Suspension de s√©ance")) {
                    <p-divider/>
                  } @else if (order.includes(".")) {
                    <p>{{ order.split(".").slice(1).join(".") }}</p>
                  } @else {
                    <p>{{ order }}</p>
                  }

                  <div class="seance-bottom">
                    <p-button label="Lire" icon="pi pi-book" outlined/>
                    <p-divider/>
                  </div>
                </ng-template>
              </p-timeline>
            </p-card>
          }
        </div>
      }
    </div>
  } @else {
    <div id="loading">
      <p-progress-spinner/>
    </div>
  }
</div>

<p-paginator
  [rows]="1"
  [totalRecords]="maxPage"
  [showCurrentPageReport]="true"
  currentPageReportTemplate="Page {currentPage}/{totalPages}"
  (onPageChange)="updatePage($event)"
></p-paginator>
