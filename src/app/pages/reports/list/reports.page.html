<ngx-teleport to="header">
  <h1>Rapports</h1>
</ngx-teleport>

@let reports = reports$ | async;
<div id="content">
  @if (!loading$()) {
    <div id="loaded">
      @for (reportGroup of (reports?.reports ?? [] | groupBy: groupByDate).entries(); track reportGroup[0]) {
        <h2 id="day">{{ formatReadableDate(reportGroup[1][0].date) }}</h2>
        <div id="seances">
          @for (report of reportGroup[1]; track report.pageLink) {
            <p-card
              class="seance"

              [header]="report.title"
              [subheader]="report.orders[0]"
              [styleClass]="'card'"
              [dt]="{
                background: '{surface.100}'
              }"
            >
              <p-timeline [value]="report.orders.slice(1)" align="left" styleClass="seance-timeline">
                <ng-template #content let-order>
                  @if (order.includes("Suspension de s√©ance")) {
                    <p-divider/>
                  } @else if (order.includes(".")) {
                    <p>{{ order.split(".").slice(1).join(".") }}</p>
                  } @else {
                    <p>{{ order }}</p>
                  }

                  <div class="seance-bottom">
                    <p-button
                      label="Lire"
                      icon="pi pi-book"
                      outlined

                      (onClick)="navigateToReport(report, order)"
                    />
                    <p-divider/>
                  </div>
                </ng-template>
              </p-timeline>
            </p-card>
          }
        </div>
      }
    </div>
  } @else {
    <div id="loading">
      <p-progress-spinner/>
    </div>
  }
</div>

<p-paginator
  [rows]="1"
  [totalRecords]="maxPage"
  [showCurrentPageReport]="true"
  [pageLinkSize]="3"
  currentPageReportTemplate=""
  (onPageChange)="updatePage($event)"
></p-paginator>
